(()=>{var ne=0,oe=0,se=[1,1,1,0,0,0,0,0,0],te=["DefendBase","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome"];{let e=channels.get("UI");memory.uistate||(memory.uistate={}),H=memory.uistate;let i=0,t=[],o=[t];A={done(){e.send(t)},button(r,{key:n=r}={}){return o[0].push({t:"button",name:r,key:n}),old=H[n],H[n]=!1,old},toggle(r,{key:n=r,def:f=!1}={}){var a;let y=(a=H[n])!=null?a:f;return o[0].push({t:"toggle",name:r,key:n,val:y}),y},line(){o[0].push({t:"line",key:i++})},separator(){o[0].push({t:"separator",key:i++})},field(r,{def:n=""}={}){var y;let f=(y=H[r])!=null?y:n;return o[0].push({t:"field",key:r,val:f}),f},label(r){o[0].push({t:"label",label:r,key:i++})},range(r,n,f,{def:y=n}={}){var p;let a=(p=H[r])!=null?p:y;return o[0].push({t:"range",min:n,max:f,key:r,val:a}),a},select(r,n,{def:f}={}){var a;let y=(a=H[r])!=null?a:f;return Array.isArray(n)&&(n=Object.fromEntries(n.map(p=>[p,p]))),o[0].push({t:"select",options:n,key:r,val:y}),y},pickSpot(r,{key:n=r}={}){return o[0].push({t:"pickSpot",name:r,key:n}),H[n]},beginCol({grow:r=!1}={}){let n=[];o[0].push({t:"col",items:n,key:i++,grow:r}),o.unshift(n)},endCol(){o.shift()}};let l=channels.recv("UI");if(l)for(J of l)H[J.key]=J.value}var H,A,J,N=[],S=[],w=[];var g=my_spirits[0].energy_capacity,Z=my_spirits[0].size;memory.uistate=H;var _=star_zxq,z=star_a1c,v=star_p89;ke();var G=0,Q=0,q=[0,0,0,0,0,0,0,0,0,0];memory.markcounts||(memory.markcounts=q);var re=new Date;le();De();be();ze();fe();Re();ae();ge();ye();pe();de();ce();ve();he();Ae();ue();me();function le(){A.label("Chain Health"),G=A.range("chainhealth",0,g-Z,{def:ne}),A.separator(),A.label("Gather Health"),Q=A.range("gatherhealth",0,g-Z,{def:oe}),A.separator();for(let e=0;e<10;e++)A.beginCol(),A.label("Squad "+e),A.endCol(),A.beginCol(),A.label(memory.markcounts[e]+" / "),A.endCol(),e<9&&(A.beginCol(),N[e]=A.field("quantity"+e,{def:se[e]}),A.endCol()),A.beginCol(),S[e]=A.select("ai"+e,["HarvestHome","HarvestOutpost","DefendBase","DefendHomeStar","DefendOutpost","AttackEnemyBase","AttackEnemyStar","SafeRallyPoint1","AggroRallyPoint1","PokeEnemyBase","PokeEnemyStar","RushEnemyStar","RushOutpostStar"],{def:te[e]}),A.endCol(),w[e]=A.pickSpot("Rally Pos"+e),e<9&&A.separator();A.done()}function me(){for(spirit of my_spirits)spirit.hp!=0&&spirit.shout(spirit.mark);console.log("Squad9: "+q[9]),console.log("Total: "+_e().length),console.log("Tick: "+tick),console.log("total execution time: "+(Date.now()-re)+"ms"),console.log("Enemy shape: "+enemy_base.shape)}function fe(){for(let e=0;e<10;e++)w[e]!=null&&(graphics.style="white",graphics.circle(w[e],1),graphics.circle(w[e],5),we([w[e][0],parseFloat(w[e][1])+30],e,"grey",.8))}function ae(){var e=-1;for(s of D("DefendBase")){e+=1;let o=m(base.position,_.position,-125),l,r=100;base.position[0]<outpost.position[0]?l=[1590,900]:l=[2650,1570];let n=K(o,l,e,D("DefendBase").length);for(;u(n,base.position)<r;)n=m(n,base.position,-1);for(;u(n,base.position)>r;)n=m(n,base.position,1);let f=m(_.position,base.position,190),y=d(s,200),a=W(n,base.sight.enemies);if(g==10&&(n=[1600,750],a!=null&&(n=m(base.position,a.position,60))),["Attacking","Searching","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&(b(s)&&(R(d(base,400))>base.energy&&s.energy>=g*.4&&(memory[s.id]="Searching"),s.energy>g*.9&&(memory[s.id]="Searching")),g==10&&(memory[s.id]="Searching")),memory[s.id]=="Searching"&&(a!=null&&a.energy<s.energy&&(memory[s.id]="Attacking"),y.length>0&&(memory[s.id]="Attacking"),(!b(s)||a==null&&s.energy<g*.9)&&(memory[s.id]="Recovering")),memory[s.id]=="Attacking"&&(!b(s)&&g!=10&&(memory[s.id]="Recovering"),a==null&&(memory[s.id]="Searching")),memory[s.id]=="Recovering"&&(g==10&&h(s),U(s)?c(s,n):(c(s,f),s.energize(s)),b(s)&&h(s),M(s),j(s)),memory[s.id]=="Searching"&&(c(s,n),h(s),j(s)),memory[s.id]=="Attacking"){var i=h(s),t;if(i!=null?(t=m(i.position,n,180),g==10&&(t=m(i.position,n,199))):a!=null&&(t=m(a.position,base.position,180),g==10&&(t=m(a.position,base.position,199))),outpost.energy>500&&outpost.control!="Aecert")for(;u(t,outpost.position)<=600;)t=m(outpost.position,t,u(t,outpost.position)+3);s.move(t),i==null&&g!=10&&E(s),j(s)}}}function ge(){var e=-1;for(s of D("DefendOutpost")){e+=1;let o,l,r=125;base.position[0]<outpost.position[0]?(o=[2190,1270],l=[1900,1600]):(o=[2020,1130],l=[1750,1500]);let n=K(o,l,e,D("DefendOutpost").length);for(;u(n,v.position)<r;)n=m(n,v.position,-1);for(;u(n,v.position)>r;)n=m(n,v.position,1);let f=300,y;base.position[0]<outpost.position[0]?y=[2020,1130]:y=[2190,1270],(outpost.control!="Aecert"||D("DefendOutpost").length==1||v.energy==0)&&(n=y,f=200);let a=d(s,200),p=W(n,outpost.sight.enemies);if(p!=null&&u(p.position,outpost.position)>f&&(p=null),outpost.control!="Aecert"&&outpost.energy!=0&&(p=null),["Attacking","Searching","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&b(s)&&(memory[s.id]="Searching"),memory[s.id]=="Searching"&&(p!=null&&p.energy<s.energy&&(memory[s.id]="Attacking"),a.length>0&&(memory[s.id]="Attacking"),(!b(s)||p==null&&s.energy<g*.9&&a.length==0)&&(memory[s.id]="Recovering")),memory[s.id]=="Attacking"&&(b(s)||(memory[s.id]="Recovering"),p==null&&a.length==0&&(memory[s.id]="Searching")),memory[s.id]=="Recovering"&&(U(s)?(s.move(n),O(s)):(s.move(y),s.energize(s)),(outpost.energy==0&&Ce(d(s,200))+g*.1<s.energy||outpost.control!="Aecert"&&p==null&&s.energy>g*.5)&&s.energize(outpost),memory[s.id+"jumped"]==!0&&(h(s),memory[s.id+"jumped"]=!1),M(s),j(s)),memory[s.id]=="Searching"&&(s.move(n),s.energize(s),h(s),j(s),outpost.control!="Aecert"?s.energy>g*.2&&s.energize(outpost):outpost.energy<990&&(v.energy>250&&e==0&&s.energize(outpost),v.energy>700&&e==2&&s.energize(outpost)),g<100&&s.energize(outpost)),memory[s.id]=="Attacking"){s.energize(s);var i=h(s),t=o;i!=null?t=m(i.position,v.position,199):p!=null&&(t=m(p.position,v.position,199)),s.move(t),i==null&&E(s),outpost.energy==0&&u(s.position,outpost.position)<200&&s.energize(outpost),M(spirit),j(s)}}}function ye(){var e=-1;for(s of D("DefendHomeStar")){e+=1;let o,l,r=150;base.position[0]<outpost.position[0]?(o=[1200,1100],l=[900,1250]):(o=[3020,1330],l=[3300,1250]);let n=K(o,l,e,D("DefendHomeStar").length);for(;u(n,_.position)<r;)n=m(n,_.position,-1);for(;u(n,_.position)>r;)n=m(n,_.position,1);let f=m(_.position,s.position,150),y=d(s,400),a=400,p=W(n,s.sight.enemies);if(p!=null&&u(p.position,_.position)>a&&(p=null),["Attacking","Searching","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&b(s)&&(memory[s.id]="Searching"),memory[s.id]=="Searching"&&(p!=null&&p.energy<s.energy&&(memory[s.id]="Attacking"),y.length>0&&(memory[s.id]="Attacking"),(!b(s)&&s.energ||p==null&&s.energy<g*.9)&&(memory[s.id]="Recovering")),memory[s.id]=="Attacking"&&(!b(s)&&s.energy<=g*.5&&(memory[s.id]="Recovering"),p==null&&(memory[s.id]="Searching")),memory[s.id]=="Recovering"&&(c(s,f),s.energize(s),memory[s.id+"jumped"]==!0&&h(s),M(s),j(s)),memory[s.id]=="Searching"){c(s,n),s.energize(s);var i=h(s);i==null&&E(s),j(s)}if(memory[s.id]=="Attacking"){s.energize(s);var i=h(s),t=n;i!=null?t=m(i.position,_.position,199):p!=null&&(t=m(p.position,_.position,199)),s.move(t),i==null&&E(s),M(spirit),j(s)}}}function ue(){for(let i=0;i<10;i++)if(S[i].includes("RallyPoint")){let t=F(i),o=S[i][S[i].length-1],l=S[i].includes("Aggro"),r=base.position;r=w[i];for(spirit of t){memory[spirit.id]="Rallying",r!=null&&c(spirit,r);let n=x(spirit,spirit.sight.enemies);if(l){let f=h(spirit);f!=null?c(spirit,m(f.position,spirit.position,198)):u(spirit.position,r)<200&&n!=null&&c(spirit,m(n.position,spirit.position,198)),f==null&&(f=O(spirit)),f==null&&spirit.energize(spirit)}if(!l){var e;R(d(spirit,250))<=spirit.energy?(e=h(spirit),e!=null&&c(spirit,m(e.position,spirit.position,198))):c(spirit,m(n.position,spirit.position,275)),e==null&&(e=O(spirit)),e==null&&spirit.energize(spirit)}}}}function pe(){for(s of D("AttackEnemyBase")){if(u(s.position,enemy_base.position)>=200){c(s,enemy_base.position),memory[s.id]="Traveling";let r=[],n=0;for(jumpSpirit of D("AttackEnemyBase")){let f=m(enemy_base.position,jumpSpirit.position,199),y=u(jumpSpirit.position,f),a=y/5;jumpSpirit.energy-a>=40&&y<=300&&g==100&&(n+=a,r.push(jumpSpirit))}if(R(C(enemy_base,300))*2+n+enemy_base.energy+50<R(r)&&g==100&&enemy_base.shape!="triangles")for(jumper of r)jumper.jump(m(enemy_base.position,jumper.position,199))}var e,i;u(s.position,enemy_base.position)<=200?memory[s.id]="Ending Game":e=h(s),e!=null?(memory[s.id]="Attacking",s.move(m(e.position,s.position,190))):memory[s.id]!="Ending Game"&&(i=E(s)),i!=null&&(s.move(m(i.position,s.position,10)),memory[s.id]="Healing")}var t=0;let o=Ee(enemy_base);for(bh of o)t+=bh.size;var l=0;for(s of He("Ending Game"))g*.2+enemy_base.energy+t>l*g*.2&&s.energy>0?(s.energize(enemy_base),l+=1):h(s)!=null?memory[s.id]="Attacking":E(s)!=null&&(memory[s.id]="Healing")}function de(){for(s of D("AttackEnemyStar")){var e=m(z.position,enemy_base.position,190);if(c(s,e),memory[s.id]="Traveling",(b(s)&&s.energy>=g*.2||s.energy>=g*.8)&&h(s)!=null&&(memory[s.id]="Attacking"),memory[s.id]!="Attacking"&&O(s)!=null&&(memory[s.id]="Healing"),memory[s.id]=="Traveling"){s.energize(s),memory[s.id]="Recovering";var i=m(z.position,s.position,195);u(s.position,z.position)>200&&!b(s)&&s.jump(i)}}}function ce(){let e=0;for(s of D("PokeEnemyBase")){e++;var i=m(_.position,s.position,199);(outpost.control=="Aecert"||outpost.energy==0&&v.energy>0)&&(i=m(v.position,s.position,199),u(s.position,z.position)<u(s.position,v.position)&&(i=m(z.position,s.position,199)));var t=m(enemy_base.position,z.position,-399);if((outpost.control=="Aecert"||outpost.energy==0)&&(t=m(enemy_base.position,v.position,350)),e+2%3==0&&v.energy>0&&(t=m(v.position,t,199)),["Attacking","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&s.energy>=g*.9&&(memory[s.id]="Attacking"),memory[s.id]=="Attacking"&&(s.energy<=g*.1&&(memory[s.id]="Recovering"),b(s)||(memory[s.id]="Recovering"),C(enemy_base,400).length==0&&s.energy>0&&(memory[s.id]="Attacking")),memory[s.id]=="Recovering"&&(X(s,i),s.energize(s),b(s)||s.jump(m(s.position,i,50)),d(s,210).length==0&&O(s)),memory[s.id]=="Attacking"){c(s,t);var o=h(s);o!=null&&s.move(m(o.position,s.position,199)),o==null&&(o=E(s)),e+2%3==0&&v.energy>0&&(o=O(s)),o==null&&s.energize(s),R(C(enemy_base,200))<s.energy&&o==null&&s.move(m(enemy_base.position,s.position,199)),d(s,200).length==0&&u(enemy_base.position,s.position)<200&&s.energize(enemy_base),R(d(s,215))>R(C(s,50))+s.energy&&s.move(i)}}}function ve(){for(s of D("PokeEnemyStar")){var e=m(z.position,enemy_base.position,-199),i=e;s.sight.enemies.length>0&&(i=m(x(s,s.sight.enemies).position,s.position,250));var t=m(z.position,enemy_base.position,199);if(["Attacking","Fleeing","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&(s.energy>g*.9&&(memory[s.id]="Attacking"),R(d(s,240))>s.energy&&(memory[s.id]="Fleeing")),memory[s.id]=="Fleeing"&&R(d(s,240))<=s.energy&&(s.energy<=g*.9&&(memory[s.id]="Recovering"),R(d(s,200))<=s.energy&&(memory[s.id]="Attacking")),memory[s.id]=="Attacking"&&(s.energy<=g*.2&&(memory[s.id]="Recovering"),R(d(s,230))>s.energy&&(memory[s.id]="Fleeing")),memory[s.id]=="Recovering"&&(X(s,e),s.energize(s),b(s)||s.jump(m(s.position,i,40)),R(d(s,200))<s.energy&&h(s)),memory[s.id]=="Fleeing"&&(X(s,i),s.energize(s),b(s)||s.jump(i),R(d(s,200))<s.energy&&h(s)),memory[s.id]=="Attacking"){c(s,t);var o=h(s);o!=null&&s.move(m(o.position,s.position,199)),o==null&&(o=E(s)),o==null&&s.energize(s)}}}function he(){for(s of D("RushEnemyStar")){var e=m(z.position,s.position,199),i=m(z.position,enemy_base.position,-199),t=m(z.position,enemy_base.position,199);if(["Attacking","Rushing","Recovering"].includes(memory[s.id])||(memory[s.id]="Rushing"),memory[s.id]=="Rushing"&&u(s.position,z.position)<200&&(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&(s.energy>g*.5&&(memory[s.id]="Attacking"),s.energy-10>=R(d(s,220))*1.5&&(memory[s.id]="Attacking"),z.energy<5&&(memory[s.id]="Attacking")),memory[s.id]=="Attacking"&&(s.energy<=g*.2&&d(s,400).length>0&&(memory[s.id]="Recovering"),s.energy<R(d(s,220))&&!b(s)&&(memory[s.id]="Recovering"),z.energy<5&&(memory[s.id]="Attacking")),memory[s.id]=="Rushing"&&(c(s,e),graphics.circle(e,2),h(s),R(d(s,210))*2>s.energy&&10+u(s.position,e)/5<s.energy&&(s.jump(e),s.energize(s)),b(s)||(s.jump(e),s.energize(s))),memory[s.id]=="Recovering"&&(s.move(i),s.energize(s)),memory[s.id]=="Attacking"){s.move(t),R(d(s,210))>s.energy&&s.move(i);var o=h(s);o==null&&(o=E(s)),o==null&&s.energize(s),d(s,400).length==0&&s.energy>g*.5&&(s.move(m(enemy_base.position,s.position,199)),s.energize(enemy_base))}}}function Ae(){for(s of D("RushOutpostStar")){var e=m(v.position,s.position,199),i=m(v.position,outpost.position,-150),t=m(v.position,outpost.position,150);if(["Attacking","Rushing","Recovering"].includes(memory[s.id])||(memory[s.id]="Rushing"),memory[s.id]=="Rushing"&&u(s.position,v.position)<200&&(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&(s.energy>g*.5&&(memory[s.id]="Attacking"),s.energy-10>=R(d(s,220))*1.5&&(memory[s.id]="Attacking")),memory[s.id]=="Attacking"&&(s.energy<=g*.2&&(memory[s.id]="Recovering"),s.energy<R(d(s,220))&&!b(s)&&(memory[s.id]="Recovering")),memory[s.id]=="Rushing"&&(s.move(e),graphics.circle(e,2),s.energize(s),R(d(s,210))*2>s.energy&&10+u(s.position,e)/5<s.energy&&s.jump(e),b(s)||s.jump(e)),memory[s.id]=="Recovering"&&(s.move(i),s.energize(s)),memory[s.id]=="Attacking"){s.move(t);var o=h(s);o==null&&(o=E(s)),o==null&&s.energy>20&&outpost.control!="Aecert"?s.energize(outpost):o==null&&s.energize(s),outpost.energy==0&&s.energize(outpost)}}}function Re(){for(let l=0;l<10;l++)if(["HarvestHome","HarvestOutpost"].includes(S[l])){var e;S[l]=="HarvestOutpost"&&(e=v),S[l]=="HarvestHome"&&(e=_);var i=F(l);for(s of i)["Depositing","Gathering","Chaining","Safe","Spawned"].includes(memory[s.id])||(memory[s.id]="Spawned");for(let r=0;r<i.length;r+=4){if(r+1==i.length){let n=i[r];["Defending","Recovering","Depositing","Gathering"].includes(memory[n.id])||(memory[n.id]="Depositing"),memory[n.id]=="Depositing"&&(n.energize(base),c(n,m(base.position,e.position,199)),n.energy<=Q&&(memory[n.id]="Gathering")),memory[n.id]=="Gathering"&&(n.energize(n),c(n,m(e.position,base.position,199)),n.energy==n.energy_capacity&&(memory[n.id]="Depositing"))}if(r+2==i.length){let n=i[r+1];["Defending","Recovering"].includes(memory[n.id])||(c(n,m(base.position,e.position,199)),n.energy>=G&&n.energize(base),memory[n.id]="Chaining");let f=i[r];["Defending","Recovering","Depositing","Gathering"].includes(memory[f.id])||(memory[f.id]="Depositing"),memory[f.id]=="Depositing"&&(n.energy<=g*.9&&f.energize(n),c(f,m(n.position,e.position,199)),f.energy<=Q&&(memory[f.id]="Gathering")),memory[f.id]=="Gathering"&&(f.energize(f),c(f,m(e.position,n.position,199)),f.energy==f.energy_capacity&&(memory[f.id]="Depositing"))}if(r+3==i.length){let n=i[r+2],f=150;["Defending","Recovering"].includes(memory[n.id])||(c(n,m(base.position,e.position,f)),n.energy>=G&&n.energize(base),memory[n.id]="Chaining");let y=i[r+1];f+=199,["Defending","Recovering"].includes(memory[y.id])||(c(y,m(base.position,e.position,f)),y.energy>=G&&n.energy<=g*.9&&y.energize(n),memory[y.id]="Chaining");let a=i[r];f+=199,["Defending","Recovering","Depositing","Gathering"].includes(memory[a.id])||(memory[a.id]="Depositing"),memory[a.id]=="Depositing"&&(c(a,m(base.position,e.position,f)),y.energy<=g*.9&&a.energize(y),a.energy<=G&&(memory[a.id]="Gathering")),memory[a.id]=="Gathering"&&(c(a,m(base.position,e.position,f)),(e.energy>150||g<100)&&a.energize(a),a.energy>=g*.9&&(memory[a.id]="Depositing"))}if(r+4<=i.length){let n=i[r+3],f=150;["Defending","Recovering"].includes(memory[n.id])||(c(n,m(base.position,e.position,f)),n.energy>=G&&n.energize(base),memory[n.id]="Chaining"),f+=199;let y=i[r+2];["Defending","Recovering"].includes(memory[n.id])||(c(y,m(base.position,e.position,f)),y.energy>=G&&n.energy<=g*.9&&y.energize(n),memory[y.id]="Chaining");let a=i[r+1],p=i[r];f+=199,["Defending","Recovering"].includes(memory[a.id])||(c(a,m(base.position,e.position,f)),tick%2==0?(a.energy>g*.7&&y.energy<=g*.9&&a.energize(y),memory[a.id]="Depositing"):((e.energy>350||g<100)&&a.energize(a),memory[a.id]="Gathering")),["Defending","Recovering"].includes(memory[p.id])||(c(p,m(base.position,e.position,f)),tick%2!=0?(p.energy>g*.7&&y.energy<=g*.9&&p.energize(y),memory[p.id]="Depositing"):((e.energy>700||g<100)&&p.energize(p),memory[p.id]="Gathering"))}}for(s of F(l))O(s)!=null&&(memory[s.id]="Healing");for(s of F(l)){var t=x(s,s.sight.enemies);if(t!=null){if(u(s.position,t.position)<=200&&memory[s.id]!="Healing"&&(memory[s.id]="Defending"),b(s)||(memory[s.id]="Recovering",s.energize(s)),memory[s.id]=="Defending"){var o=h(s);let r=m(o.position,s.position,190);s.move(r)}if(memory[s.id]=="Recovering"){s.energize(s);let r=m(e.position,s.position,190);s.move(r),u(s.position,t.position)<=200&&u(s.position,e.position)>199&&u(s.position,r)/5<s.energy&&s.jump(r),s.energy>=80&&(memory[s.id]="Defending")}}else["Defending","Recovering"].includes(memory[s.id])&&(memory[s.id]="Safe")}}}function be(){let e=[],i=[],t=[],o=[],l=[],r=[],n=[],f=[],y=[],a=[],p=[e,i,t,o,l,r,n,f,y,a];for(spirit of my_spirits)if(spirit.hp!=0){spirit.mark==null&&spirit.set_mark("Squad9"),memory[spirit.id]==null&&(memory[spirit.id]="Spawned");for(let k=0;k<10;k++)spirit.mark==k&&p[k].push(spirit)}for(let k=0;k<9;k++)for(;p[k].length>N[k];){let P=p[k].pop();a.push(P),memory[P.id]="Spawned"}for(let k=0;k<9;k++)for(;p[k].length<N[k]&&a.length>0;){let P=a.pop();p[k].push(P)}for(let k=0;k<10;k++)for(spirit of p[k])spirit.set_mark(String(k))}function K(e,i,t,o){var l,r=u(e,i),n=r/(o-1);return l=m(e,i,n*(t-1)),o>=2?(t==0&&(l=e),t==1&&(l=i)):o>=1&&t==0&&(l=m(e,i,r/2)),l}function M(e){if(!(g<100)&&!b(e)){var i=x(e,e.sight.enemies),t=m(i.position,e.position,220);t!=null&&e.energy<=50&&e.jump(t)}}function u(e,i){let t=e[0],o=e[1],l=i[0],r=i[1],n=l-t,f=r-o;return Math.sqrt(f*f+n*n)}function m(e,i,t){var o=i[0]-e[0],l=i[1]-e[1],r=Math.sqrt(o*o+l*l),n=t/r;let f=e[0]+o*n,y=e[1]+l*n;var a=[f,y];return a}function V(e){let i=_,t=u(e.position,_.position),o=u(e.position,v.position),l=u(e.position,z.position);return o<t&&(i=v),l<u(e.position,i.position)&&(i=z),i}function ke(){u(base.position,star_zxq.position)<u(base.position,star_a1c.position)?(_=star_zxq,z=star_a1c):(_=star_a1c,z=star_zxq)}function ze(){for(spirit of my_spirits)if(spirit.hp>0){let e=parseInt(spirit.mark,10);q[e]=q[e]+1}memory.markcounts=q}function x(e,i){if(i.length==0)return null;var t=spirits[i[0]],o=9999;for(id of i)u(e.position,spirits[id].position)<o&&(t=spirits[id],o=u(e.position,t.position));return t}function W(e,i){if(i.length==0)return null;var t=spirits[i[0]],o=9999;for(id of i)u(e,spirits[id].position)<o&&(t=spirits[id],o=u(e,t.position));return t}function $(e){var i=[];for(id of e)i.push(spirits[id]);return i}function R(e){var i=0;for(spirit of e)i+=spirit.energy;return i}function d(e,i=200){var t=$(e.sight.enemies),o=[];for(enemy of t)u(enemy.position,e.position)<=i&&o.push(enemy);return o}function C(e,i=200){var t=$(e.sight.friends),o=[];for(ally of t)u(ally.position,e.position)<=i&&o.push(ally);return o}function _e(){var e=[];for(spirit of my_spirits)spirit.hp>0&&e.push(spirit);return e}function h(e){var i=d(e);if(i.length!=0&&e.energy!=0){var t=[];for(ally of my_spirits)t.push(memory[ally.id+"attack target"]);var o,l,r,n;for(enemy of i){var f=0;for(target of t)target==enemy.id&&(f+=1);(o==null||f<o)&&(o=f,r=enemy),(l==null||f>l)&&(l=f,n=enemy)}if(!(o*g*.2>r.energy))return memory[e.id+"jumped"]=!1,l*g*.2<=n.energy?(memory[e.id+"attack target"]=n.id,e.energize(n),n):(memory[e.id+"attack target"]=r.id,e.energize(r),r)}}function O(e){var i=C(e);if(i.length!=0&&e.energy!=0){var t=[];for(ally of my_spirits)t.push(memory[ally.id+"heal target"]);var o,l;for(ally of i){var r=0;for(target of t)target==ally.id&&(r+=1);(o==null||r<o)&&!(["Gathering","Depositing","Chaining","Healing"].includes(memory[ally.id])&&I(ally)==null)&&ally.energy<g&&memory[ally.id+"heal target"]!=e.id&&(o=r,l=ally)}if(l==null)return null;if(!(o*g*.1>g-l.energy||u(V(l).position,l.position)<=200&&V(l).energy>=g*.1))return memory[e.id+"heal target"]=l.id,e.energize(l),l}}function j(e){if(!(g<100)){var i=d(e,400),t=[];for(enemy of i){var a=m(enemy.position,e.position,160),o=u(a,e.position),l=C(enemy,210),r=enemy.energy-enemy.size,n=je(enemy);(enemy.energy<=19&&(enemy.energy_capacity>=20||ie(e)=="DefendBase")&&e.energy-10>o/5+r+n+1&&u(enemy.position,e.position)>195&&!ee(enemy)&&C(enemy,250).length==0||enemy.energy<=19&&(enemy.energy_capacity>=20||ie(e)=="DefendBase")&&e.energy-10>o/5+r+n+R(l)*2&&u(enemy.position,e.position)>195&&u(enemy.position,e.position)<360&&!ee(enemy))&&t.push(enemy)}var f=[];for(ally of my_spirits)f.push(memory[ally.id+"jump target"]),f.push(memory[ally.id+"attack target"]);var y;for(enemy of t)if(!f.includes(enemy.id)){y=enemy;break}if(y==null)return null;var a=m(y.position,e.position,150);return e.jump(a),e.move(a),e.energize(y),memory[ally.id+"jump target"]=y.id,memory[e.id+"jumped"]=!0,y}}function E(e){var i=C(e),t=[];for(ally of i)(I(ally)!=null||ally.energy<e.energy&&d(ally,300).length>0&&u(s.position,V(s).position)>200)&&t.push(ally);if(t.length==0)return null;var o,l;for(ally of t)(o==null||o>ally.energy)&&(o=ally.energy,l=ally);return memory[e.id+"heal target"]=l.id,e.energize(l),l}function De(){for(spirit of my_spirits)memory[spirit.id+"attack target"]="",memory[spirit.id+"heal target"]="",memory[spirit.id+"jump target"]=""}function c(e,i){if(e.move(i),outpost.control=="Aecert"||outpost.energy==0)return;let t=400;if(outpost.energy>400&&(t=600),u(e.position,outpost.position)<=t){e.move(m(outpost.position,e.position,t+5));return}let o=[e.position,i],l=0;if(outpost.control!="Aecert"&&outpost.energy!=0)for(;B(outpost.position,o[0],o[1])<=t+5;){let r=T(o[0],o[1],l),n=T(o[0],o[1],-l);if(B(outpost.position,e.position,r)>t){e.move(r);return}if(B(outpost.position,e.position,n)>t){e.move(n);return}l>200&&e.move(m(outpost.position,e.position,t+5)),l+=.1}}function X(e,i){e.move(i);let t=260,o=x(e,e.sight.enemies);if(o==null)return;if(u(e.position,o.position)<=200){e.move(m(o.position,e.position,t));return}let r=[e.position,i],n=0;for(;B(o.position,r[0],r[1])<=t;){let f=T(r[0],r[1],n),y=T(r[0],r[1],-n);if(B(o.position,e.position,f)>t){e.move(f);return}if(B(o.position,e.position,y)>t){e.move(y);return}if(n>360){e.move(m(o.position,e.position,t+5));return}n+=.1}}function T(e,i,t){let o=i[0],l=i[1];o=o-e[0],l=l-e[1];let r=o*Math.cos(t)-l*Math.sin(t),n=l*Math.cos(t)+o*Math.sin(t);return r=r+e[0],n=n+e[1],[r,n]}function L(e){return e*e}function Y(e,i){return L(e[0]-i[0])+L(e[1]-i[1])}function Se(e,i,t){var o=Y(i,t);if(o===0)return Y(e,i);var l=((e[0]-i[0])*(t[0]-i[0])+(e[1]-i[1])*(t[1]-i[1]))/o;return l=Math.max(0,Math.min(1,l)),Y(e,[i[0]+l*(t[0]-i[0]),i[1]+l*(t[1]-i[1])])}function B(e,i,t){return Math.sqrt(Se(e,i,t))}function D(e){var i=[];for(let t=0;t<10;t++)if(S[t]==e)for(spirit of F(String(t)))i.push(spirit);return i}function He(e){var i=[];for(spirit of my_spirits)memory[spirit.id]==e&&i.push(spirit);return i}function I(e){for(enemy of d(e))if(enemy.last_energized==e.id)return enemy;return null}function Ee(e){var i=[];for(ally of C(e))ally.last_energized==e.id&&i.push(ally);return i}function U(e){for(ally of my_spirits)if(memory[ally.id+"heal target"]==e.id)return!0;return!1}function b(e){var i=!0,t=[];for(enemy of d(e,200))enemy.last_energized==e.id&&t.push(enemy);return t.length==0?i=!0:t.length==1?e.energy>t[0].energy?i=!0:i=!1:t.length==2?e.energy>t[0].energy+t[1].energy*2?i=!0:i=!1:i=R(t)*2<e.energy,i}function ee(e){if(outpost.sight.enemies.length==0||outpost.energy==0)return!1;var i=!1,t=2;outpost.energy>=500&&(t=8);var o=u(e.position,outpost.position),l=o/20*2/outpost.sight.enemies.length;return l>e.energy?!0:(console.log(e.id+" will die to outpost"),!1)}function Ce(e){var i=0;for(spirit of e)spirit.energy<spirit.size?i+=spirit.energy*2:i+=spirit.size*2;return i}function je(e){var i=0;return e.energy<e.size?i+=e.energy*2:i+=e.size*2,i}function F(e){var i=[];for(spirit of my_spirits)spirit.mark==e&&spirit.hp>0&&i.push(spirit);return i}function ie(e){for(let i=0;i<10;i++)if(D(S[i]).includes(e))return S[i]}function we(e,i,t,o){graphics.style=t;let l=parseFloat(e[0]),r=parseFloat(e[1]),n=[!1,!1,!1,!1,!1,!1,!1];i==0&&(n=[!0,!0,!0,!1,!0,!0,!0]),i==1&&(n=[!1,!1,!0,!1,!1,!0,!1]),i==2&&(n=[!0,!1,!0,!0,!0,!1,!0]),i==3&&(n=[!0,!1,!0,!0,!1,!0,!0]),i==4&&(n=[!1,!0,!0,!0,!1,!0,!1]),i==5&&(n=[!0,!0,!1,!0,!1,!0,!0]),i==6&&(n=[!0,!0,!1,!0,!0,!0,!0]),i==7&&(n=[!0,!1,!0,!1,!1,!0,!1]),i==8&&(n=[!0,!0,!0,!0,!0,!0,!0]),i==9&&(n=[!0,!0,!0,!0,!1,!0,!0]),n[0]&&graphics.line([l-5*o,r-10*o],[l+5*o,r-10*o]),n[1]&&graphics.line([l-5*o,r-10*o],[l-5*o,r]),n[2]&&graphics.line([l+5*o,r-10*o],[l+5*o,r]),n[3]&&graphics.line([l-5*o,r],[l+5*o,r]),n[4]&&graphics.line([l-5*o,r+10*o],[l-5*o,r]),n[5]&&graphics.line([l+5*o,r+10*o],[l+5*o,r]),n[6]&&graphics.line([l-5*o,r+10*o],[l+5*o,r+10*o])}})();
