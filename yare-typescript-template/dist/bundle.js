(()=>{var ne=90,oe=10,se=[1,1,1,0,0,0,0,0,0],te=["HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome","HarvestHome"];{let e=channels.get("UI");memory.uistate||(memory.uistate={}),E=memory.uistate;let i=0,r=[],o=[r];v={done(){e.send(r)},button(t,{key:n=t}={}){return o[0].push({t:"button",name:t,key:n}),old=E[n],E[n]=!1,old},toggle(t,{key:n=t,def:m=!1}={}){var u;let a=(u=E[n])!=null?u:m;return o[0].push({t:"toggle",name:t,key:n,val:a}),a},line(){o[0].push({t:"line",key:i++})},separator(){o[0].push({t:"separator",key:i++})},field(t,{def:n=""}={}){var a;let m=(a=E[t])!=null?a:n;return o[0].push({t:"field",key:t,val:m}),m},label(t){o[0].push({t:"label",label:t,key:i++})},range(t,n,m,{def:a=n}={}){var p;let u=(p=E[t])!=null?p:a;return o[0].push({t:"range",min:n,max:m,key:t,val:u}),u},select(t,n,{def:m}={}){var u;let a=(u=E[t])!=null?u:m;return Array.isArray(n)&&(n=Object.fromEntries(n.map(p=>[p,p]))),o[0].push({t:"select",options:n,key:t,val:a}),a},pickSpot(t,{key:n=t}={}){return o[0].push({t:"pickSpot",name:t,key:n}),E[n]},beginCol({grow:t=!1}={}){let n=[];o[0].push({t:"col",items:n,key:i++,grow:t}),o.unshift(n)},endCol(){o.shift()}};let l=channels.recv("UI");if(l)for(N of l)E[N.key]=N.value}var E,v,N,Q=[],S=[],G=[];var g=my_spirits[0].energy_capacity,Z=my_spirits[0].size;memory.uistate=E;var _=star_zxq,z=star_a1c,h=star_p89;ke();var O=0,T=0,H=[0,0,0,0,0,0,0,0,0,0];memory.markcounts||(memory.markcounts=H);var re=new Date;le();De();be();ze();fe();Re();ae();ge();ye();pe();de();ce();ve();he();Ae();ue();me();function le(){v.label("Chain Health"),O=v.range("chainhealth",0,g-Z,{def:ne}),v.separator(),v.label("Gather Health"),T=v.range("gatherhealth",0,g-Z,{def:oe}),v.separator();for(let e=0;e<10;e++)v.beginCol(),v.label("Squad "+e),v.endCol(),v.beginCol(),v.label(memory.markcounts[e]+" / "),v.endCol(),e<9&&(v.beginCol(),Q[e]=v.field("quantity"+e,{def:se[e]}),v.endCol()),v.beginCol(),S[e]=v.select("ai"+e,["HarvestHome","HarvestOutpost","DefendBase","DefendHomeStar","DefendOutpost","AttackEnemyBase","AttackEnemyStar","SafeRallyPoint1","AggroRallyPoint1","PokeEnemyBase","PokeEnemyStar","RushEnemyStar","RushOutpostStar"],{def:te[e]}),v.endCol(),G[e]=v.pickSpot("Rally Pos"+e),e<9&&v.separator();v.done()}function me(){for(spirit of my_spirits)spirit.hp!=0&&spirit.shout(spirit.mark);console.log("Squad9: "+H[9]),console.log("Total: "+_e().length),console.log("Tick: "+tick),console.log("total execution time: "+(Date.now()-re)+"ms"),console.log("Enemy shape: "+enemy_base.shape)}function fe(){for(let e=0;e<10;e++)G[e]!=null&&(graphics.style="white",graphics.circle(G[e],1),graphics.circle(G[e],5),we([G[e][0],parseFloat(G[e][1])+30],e,"grey",.8))}function ae(){var e=-1;for(s of D("DefendBase")){e+=1;let o=f(base.position,_.position,-125),l,t=100;base.position[0]<outpost.position[0]?l=[1590,900]:l=[2650,1570];let n=K(o,l,e,D("DefendBase").length);for(;y(n,base.position)<t;)n=f(n,base.position,-1);for(;y(n,base.position)>t;)n=f(n,base.position,1);let m=f(_.position,base.position,190),a=c(s,200),u=W(n,base.sight.enemies);if(g==10&&(n=[1600,750],u!=null&&(n=f(base.position,u.position,60))),["Attacking","Searching","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&(b(s)&&(A(c(base,400))>base.energy&&s.energy>=g*.4&&(memory[s.id]="Searching"),s.energy>g*.9&&(memory[s.id]="Searching")),g==10&&(memory[s.id]="Searching")),memory[s.id]=="Searching"&&(u!=null&&u.energy<s.energy&&(memory[s.id]="Attacking"),a.length>0&&(memory[s.id]="Attacking"),(!b(s)||u==null&&s.energy<g*.9)&&(memory[s.id]="Recovering"),g==10&&s.energy>1&&(memory[s.id]="Attacking")),memory[s.id]=="Attacking"&&(!b(s)&&g!=10&&(memory[s.id]="Recovering"),u==null&&(memory[s.id]="Searching")),memory[s.id]=="Recovering"&&(U(s)?d(s,n):(d(s,m),s.energize(s)),b(s)&&R(s),x(s),w(s)),memory[s.id]=="Searching"&&(d(s,n),R(s),w(s)),memory[s.id]=="Attacking"){var i=R(s),r;if(i!=null?(r=f(i.position,n,180),g==10&&(r=f(i.position,n,199))):u!=null&&(r=f(u.position,base.position,180),g==10&&(r=f(u.position,base.position,199))),outpost.energy>500&&outpost.control!="Aecert")for(;y(r,outpost.position)<=600;)r=f(outpost.position,r,y(r,outpost.position)+3);s.move(r),i==null&&g!=10&&C(s),w(s)}}}function ge(){var e=-1;for(s of D("DefendOutpost")){e+=1;let o,l,t=125;base.position[0]<outpost.position[0]?(o=[2190,1270],l=[1900,1600]):(o=[2020,1130],l=[1750,1500]);let n=K(o,l,e,D("DefendOutpost").length);for(;y(n,h.position)<t;)n=f(n,h.position,-1);for(;y(n,h.position)>t;)n=f(n,h.position,1);let m=300,a;base.position[0]<outpost.position[0]?a=[2020,1130]:a=[2190,1270],(outpost.control!="Aecert"||D("DefendOutpost").length==1||h.energy==0)&&(n=a,m=200);let u=c(s,200),p=W(n,outpost.sight.enemies);if(p!=null&&y(p.position,outpost.position)>m&&(p=null),outpost.control!="Aecert"&&outpost.energy!=0&&(p=null),["Attacking","Searching","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&b(s)&&(memory[s.id]="Searching"),memory[s.id]=="Searching"&&(p!=null&&p.energy<s.energy&&(memory[s.id]="Attacking"),u.length>0&&(memory[s.id]="Attacking"),(!b(s)||p==null&&s.energy<g*.9&&u.length==0)&&(memory[s.id]="Recovering")),memory[s.id]=="Attacking"&&(b(s)||(memory[s.id]="Recovering"),p==null&&u.length==0&&(memory[s.id]="Searching")),memory[s.id]=="Recovering"&&(U(s)?(s.move(n),q(s)):(s.move(a),s.energize(s)),(outpost.energy==0&&Ce(c(s,200))+g*.1<s.energy||outpost.control!="Aecert"&&p==null&&s.energy>g*.5)&&s.energize(outpost),memory[s.id+"jumped"]==!0&&(R(s),memory[s.id+"jumped"]=!1),x(s),w(s)),memory[s.id]=="Searching"&&(s.move(n),s.energize(s),R(s),w(s),outpost.control!="Aecert"?s.energy>g*.2&&s.energize(outpost):outpost.energy<990&&(h.energy>250&&e==0&&s.energize(outpost),h.energy>700&&e==2&&s.energize(outpost)),g<100&&s.energize(outpost)),memory[s.id]=="Attacking"){s.energize(s);var i=R(s),r=o;i!=null?r=f(i.position,h.position,199):p!=null&&(r=f(p.position,h.position,199)),s.move(r),i==null&&C(s),outpost.energy==0&&y(s.position,outpost.position)<200&&s.energize(outpost),x(spirit),w(s)}}}function ye(){var e=-1;for(s of D("DefendHomeStar")){e+=1;let o,l,t=150;base.position[0]<outpost.position[0]?(o=[1200,1100],l=[900,1250]):(o=[3020,1330],l=[3300,1250]);let n=K(o,l,e,D("DefendHomeStar").length);for(;y(n,_.position)<t;)n=f(n,_.position,-1);for(;y(n,_.position)>t;)n=f(n,_.position,1);let m=f(_.position,s.position,150),a=c(s,400),u=400,p=W(n,s.sight.enemies);if(p!=null&&y(p.position,_.position)>u&&(p=null),["Attacking","Searching","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&b(s)&&(memory[s.id]="Searching"),memory[s.id]=="Searching"&&(p!=null&&p.energy<s.energy&&(memory[s.id]="Attacking"),a.length>0&&(memory[s.id]="Attacking"),(!b(s)&&s.energ||p==null&&s.energy<g*.9)&&(memory[s.id]="Recovering")),memory[s.id]=="Attacking"&&(!b(s)&&s.energy<=g*.5&&(memory[s.id]="Recovering"),p==null&&(memory[s.id]="Searching")),memory[s.id]=="Recovering"&&(d(s,m),s.energize(s),memory[s.id+"jumped"]==!0&&R(s),x(s),w(s)),memory[s.id]=="Searching"){d(s,n),s.energize(s);var i=R(s);i==null&&C(s),w(s)}if(memory[s.id]=="Attacking"){s.energize(s);var i=R(s),r=n;i!=null?r=f(i.position,_.position,199):p!=null&&(r=f(p.position,_.position,199)),s.move(r),i==null&&C(s),x(spirit),w(s)}}}function ue(){for(let i=0;i<10;i++)if(S[i].includes("RallyPoint")){let r=F(i),o=S[i][S[i].length-1],l=S[i].includes("Aggro"),t=base.position;t=G[i];for(spirit of r){memory[spirit.id]="Rallying",t!=null&&d(spirit,t);let n=M(spirit,spirit.sight.enemies);if(l){let m=R(spirit);m!=null?d(spirit,f(m.position,spirit.position,198)):y(spirit.position,t)<200&&n!=null&&d(spirit,f(n.position,spirit.position,198)),m==null&&(m=q(spirit)),m==null&&spirit.energize(spirit)}if(!l){var e;A(c(spirit,250))<=spirit.energy?(e=R(spirit),e!=null&&d(spirit,f(e.position,spirit.position,198))):d(spirit,f(n.position,spirit.position,275)),e==null&&(e=q(spirit)),e==null&&spirit.energize(spirit)}}}}function pe(){for(s of D("AttackEnemyBase")){if(y(s.position,enemy_base.position)>=200){d(s,enemy_base.position),memory[s.id]="Traveling";let t=[],n=0;for(jumpSpirit of D("AttackEnemyBase")){let m=f(enemy_base.position,jumpSpirit.position,199),a=y(jumpSpirit.position,m),u=a/5;jumpSpirit.energy-u>=40&&a<=300&&g==100&&(n+=u,t.push(jumpSpirit))}if(A(j(enemy_base,300))*2+n+enemy_base.energy+50<A(t)&&g==100&&enemy_base.shape!="triangles")for(jumper of t)jumper.jump(f(enemy_base.position,jumper.position,199))}var e,i;y(s.position,enemy_base.position)<=200?memory[s.id]="Ending Game":e=R(s),e!=null?(memory[s.id]="Attacking",s.move(f(e.position,s.position,190))):memory[s.id]!="Ending Game"&&(i=C(s)),i!=null&&(s.move(f(i.position,s.position,10)),memory[s.id]="Healing")}var r=0;let o=Ee(enemy_base);for(bh of o)r+=bh.size;var l=0;for(s of He("Ending Game"))g*.2+enemy_base.energy+r>l*g*.2&&s.energy>0?(s.energize(enemy_base),l+=1):R(s)!=null?memory[s.id]="Attacking":C(s)!=null&&(memory[s.id]="Healing")}function de(){for(s of D("AttackEnemyStar")){var e=f(z.position,enemy_base.position,190);if(d(s,e),memory[s.id]="Traveling",(b(s)&&s.energy>=g*.2||s.energy>=g*.8)&&R(s)!=null&&(memory[s.id]="Attacking"),memory[s.id]!="Attacking"&&q(s)!=null&&(memory[s.id]="Healing"),memory[s.id]=="Traveling"){s.energize(s),memory[s.id]="Recovering";var i=f(z.position,s.position,195);y(s.position,z.position)>200&&!b(s)&&s.jump(i)}}}function ce(){let e=0;for(s of D("PokeEnemyBase")){e++;var i=f(_.position,s.position,199);(outpost.control=="Aecert"||outpost.energy==0&&h.energy>0)&&(i=f(h.position,s.position,199),y(s.position,z.position)<y(s.position,h.position)&&(i=f(z.position,s.position,199)));var r=f(enemy_base.position,z.position,-399);if((outpost.control=="Aecert"||outpost.energy==0)&&(r=f(enemy_base.position,h.position,350),outpost.energy>=500&&(r=f(outpost.position,enemy_base.position,399))),(e==2||e==6||e==10||e==14)&&h.energy>0&&(r=f(h.position,r,199)),["Attacking","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&s.energy>=g*.9&&(memory[s.id]="Attacking"),memory[s.id]=="Attacking"&&(s.energy<=g*.1&&(memory[s.id]="Recovering"),b(s)||(memory[s.id]="Recovering"),j(enemy_base,400).length==0&&s.energy>0&&(memory[s.id]="Attacking")),memory[s.id]=="Recovering"&&(X(s,i),s.energize(s),b(s)||s.jump(f(s.position,i,50)),c(s,210).length==0&&q(s)),memory[s.id]=="Attacking"){d(s,r);var o=R(s);o!=null&&s.move(f(o.position,s.position,199)),o==null&&(o=C(s)),o==null&&s.energize(s),A(j(enemy_base,200))<s.energy&&o==null&&s.move(f(enemy_base.position,s.position,199)),c(s,200).length==0&&y(enemy_base.position,s.position)<200&&s.energize(enemy_base),A(c(s,215))>A(j(s,50))+s.energy&&s.move(i)}}}function ve(){for(s of D("PokeEnemyStar")){var e=f(z.position,enemy_base.position,-199),i=e;s.sight.enemies.length>0&&(i=f(M(s,s.sight.enemies).position,s.position,250));var r=f(z.position,enemy_base.position,199);if(["Attacking","Fleeing","Recovering"].includes(memory[s.id])||(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&(s.energy>g*.9&&(memory[s.id]="Attacking"),A(c(s,240))>s.energy&&(memory[s.id]="Fleeing")),memory[s.id]=="Fleeing"&&A(c(s,240))<=s.energy&&(s.energy<=g*.9&&(memory[s.id]="Recovering"),A(c(s,200))<=s.energy&&(memory[s.id]="Attacking")),memory[s.id]=="Attacking"&&(s.energy<=g*.2&&(memory[s.id]="Recovering"),A(c(s,230))>s.energy&&(memory[s.id]="Fleeing")),memory[s.id]=="Recovering"&&(X(s,e),s.energize(s),b(s)||s.jump(f(s.position,i,40)),A(c(s,200))<s.energy&&R(s)),memory[s.id]=="Fleeing"&&(X(s,i),s.energize(s),b(s)||s.jump(i),A(c(s,200))<s.energy&&R(s)),memory[s.id]=="Attacking"){d(s,r);var o=R(s);o!=null&&s.move(f(o.position,s.position,199)),o==null&&(o=C(s)),o==null&&s.energize(s)}}}function he(){for(s of D("RushEnemyStar")){var e=f(z.position,s.position,199),i=f(z.position,enemy_base.position,-199),r=f(z.position,enemy_base.position,199);if(["Attacking","Rushing","Recovering"].includes(memory[s.id])||(memory[s.id]="Rushing"),memory[s.id]=="Rushing"&&y(s.position,z.position)<200&&(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&(s.energy>g*.5&&(memory[s.id]="Attacking"),s.energy-10>=A(c(s,220))*1.5&&(memory[s.id]="Attacking"),z.energy<5&&(memory[s.id]="Attacking")),memory[s.id]=="Attacking"&&(s.energy<=g*.2&&c(s,400).length>0&&(memory[s.id]="Recovering"),s.energy<A(c(s,220))&&!b(s)&&(memory[s.id]="Recovering"),z.energy<5&&(memory[s.id]="Attacking")),memory[s.id]=="Rushing"&&(d(s,e),graphics.circle(e,2),R(s),A(c(s,210))*2>s.energy&&10+y(s.position,e)/5<s.energy&&(s.jump(e),s.energize(s)),b(s)||(s.jump(e),s.energize(s))),memory[s.id]=="Recovering"&&(s.move(i),s.energize(s)),memory[s.id]=="Attacking"){s.move(r),A(c(s,210))>s.energy&&s.move(i);var o=R(s);o==null&&(o=C(s)),o==null&&s.energize(s),c(s,400).length==0&&s.energy>g*.5&&(s.move(f(enemy_base.position,s.position,199)),s.energize(enemy_base))}}}function Ae(){for(s of D("RushOutpostStar")){var e=f(h.position,s.position,199),i=f(h.position,outpost.position,-150),r=f(h.position,outpost.position,150);if(["Attacking","Rushing","Recovering"].includes(memory[s.id])||(memory[s.id]="Rushing"),memory[s.id]=="Rushing"&&y(s.position,h.position)<200&&(memory[s.id]="Recovering"),memory[s.id]=="Recovering"&&(s.energy>g*.5&&(memory[s.id]="Attacking"),s.energy-10>=A(c(s,220))*1.5&&(memory[s.id]="Attacking")),memory[s.id]=="Attacking"&&(s.energy<=g*.2&&(memory[s.id]="Recovering"),s.energy<A(c(s,220))&&!b(s)&&(memory[s.id]="Recovering")),memory[s.id]=="Rushing"&&(s.move(e),graphics.circle(e,2),s.energize(s),A(c(s,210))*2>s.energy&&10+y(s.position,e)/5<s.energy&&s.jump(e),b(s)||s.jump(e)),memory[s.id]=="Recovering"&&(s.move(i),s.energize(s)),memory[s.id]=="Attacking"){s.move(r);var o=R(s);o==null&&(o=C(s)),o==null&&s.energy>20&&outpost.control!="Aecert"?s.energize(outpost):o==null&&s.energize(s),outpost.energy==0&&s.energize(outpost)}}}function Re(){for(let l=0;l<10;l++)if(["HarvestHome","HarvestOutpost"].includes(S[l])){var e;S[l]=="HarvestOutpost"&&(e=h),S[l]=="HarvestHome"&&(e=_);var i=F(l);for(s of i)["Depositing","Gathering","Chaining","Safe","Spawned"].includes(memory[s.id])||(memory[s.id]="Spawned");if(H[l]==1){let t=i[0];["Defending","Recovering","Depositing","Gathering"].includes(memory[t.id])||(memory[t.id]="Depositing"),memory[t.id]=="Depositing"&&(t.energize(base),d(t,f(base.position,e.position,199)),t.energy<=T&&(memory[t.id]="Gathering")),memory[t.id]=="Gathering"&&(t.energize(t),d(t,f(e.position,base.position,199)),t.energy==t.energy_capacity&&(memory[t.id]="Depositing"))}if(H[l]==2){let t=i[1];["Defending","Recovering"].includes(memory[t.id])||(d(t,f(base.position,e.position,199)),t.energy>=O&&t.energize(base),memory[t.id]="Chaining");let n=i[0];["Defending","Recovering","Depositing","Gathering"].includes(memory[n.id])||(memory[n.id]="Depositing"),memory[n.id]=="Depositing"&&(t.energy<=g*.9&&n.energize(t),d(n,f(t.position,e.position,199)),n.energy<=T&&(memory[n.id]="Gathering")),memory[n.id]=="Gathering"&&(n.energize(n),d(n,f(e.position,t.position,199)),n.energy==n.energy_capacity&&(memory[n.id]="Depositing"))}if(H[l]==3){let t=i[2],n=150;["Defending","Recovering"].includes(memory[t.id])||(d(t,f(base.position,e.position,n)),t.energy>=O&&t.energize(base),memory[t.id]="Chaining");let m=i[1];n+=199,["Defending","Recovering"].includes(memory[m.id])||(d(m,f(base.position,e.position,n)),m.energy>=O&&t.energy<=g*.9&&m.energize(t),memory[m.id]="Chaining");let a=i[0];n+=199,["Defending","Recovering","Depositing","Gathering"].includes(memory[a.id])||(memory[a.id]="Depositing"),memory[a.id]=="Depositing"&&(d(a,f(base.position,e.position,n)),m.energy<=g*.9&&a.energize(m),a.energy<=O&&(memory[a.id]="Gathering")),memory[a.id]=="Gathering"&&(d(a,f(base.position,e.position,n)),(e.energy>150||g<100)&&a.energize(a),a.energy>=g*.9&&(memory[a.id]="Depositing"))}if(H[l]>=4&&g>=30){let t=i[3],n=150;["Defending","Recovering"].includes(memory[t.id])||(d(t,f(base.position,e.position,n)),t.energy>=O&&t.energize(base),memory[t.id]="Chaining"),n+=199;let m=i[2];["Defending","Recovering"].includes(memory[t.id])||(d(m,f(base.position,e.position,n)),m.energy>=O&&t.energy<=g*.9&&m.energize(t),memory[m.id]="Chaining");let a=i[1],u=i[0];n+=199,["Defending","Recovering"].includes(memory[a.id])||(d(a,f(base.position,e.position,n)),tick%2==0?(a.energy>g*.7&&m.energy<=g*.9&&a.energize(m),memory[a.id]="Depositing"):((e.energy>350||g<100)&&a.energize(a),memory[a.id]="Gathering")),["Defending","Recovering"].includes(memory[u.id])||(d(u,f(base.position,e.position,n)),tick%2!=0?(u.energy>g*.7&&m.energy<=g*.9&&u.energize(m),memory[u.id]="Depositing"):((e.energy>700||g<100)&&u.energize(u),memory[u.id]="Gathering"))}if(H[l]>4){let t=4;g==10&&(t=0);for(let n=t;n<H[l];n++){let m=i[n];["Defending","Recovering","Depositing","Gathering"].includes(memory[m.id])||(memory[m.id]="Depositing"),memory[m.id]=="Depositing"&&(m.energize(base),d(m,f(base.position,e.position,199)),m.energy<=T&&(memory[m.id]="Gathering")),memory[m.id]=="Gathering"&&((e.energy>900||g<100)&&m.energize(m),y(m.position,e.position)>200&&d(m,e.position),m.energy==m.energy_capacity&&(memory[m.id]="Depositing"))}}for(s of F(l))q(s)!=null&&(memory[s.id]="Healing");for(s of F(l)){var r=M(s,s.sight.enemies);if(r!=null){if(y(s.position,r.position)<=200&&memory[s.id]!="Healing"&&(memory[s.id]="Defending"),b(s)||(memory[s.id]="Recovering",s.energize(s)),memory[s.id]=="Defending"){var o=R(s);let t=f(o.position,s.position,190);s.move(t)}if(memory[s.id]=="Recovering"){s.energize(s);let t=f(e.position,s.position,190);s.move(t),y(s.position,r.position)<=200&&y(s.position,e.position)>199&&y(s.position,t)/5<s.energy&&s.jump(t),s.energy>=80&&(memory[s.id]="Defending")}}else["Defending","Recovering"].includes(memory[s.id])&&(memory[s.id]="Safe")}}}function be(){let e=[],i=[],r=[],o=[],l=[],t=[],n=[],m=[],a=[],u=[],p=[e,i,r,o,l,t,n,m,a,u];for(spirit of my_spirits)if(spirit.hp!=0){spirit.mark==null&&spirit.set_mark("Squad9"),memory[spirit.id]==null&&(memory[spirit.id]="Spawned");for(let k=0;k<10;k++)spirit.mark==k&&p[k].push(spirit)}for(let k=0;k<9;k++)for(;p[k].length>Q[k];){let P=p[k].pop();u.push(P),memory[P.id]="Spawned"}for(let k=0;k<9;k++)for(;p[k].length<Q[k]&&u.length>0;){let P=u.pop();p[k].push(P)}for(let k=0;k<10;k++)for(spirit of p[k])spirit.set_mark(String(k))}function K(e,i,r,o){var l,t=y(e,i),n=t/(o-1);return l=f(e,i,n*(r-1)),o>=2?(r==0&&(l=e),r==1&&(l=i)):o>=1&&r==0&&(l=f(e,i,t/2)),l}function x(e){if(!(g<100)&&!b(e)){var i=M(e,e.sight.enemies),r=f(i.position,e.position,220);r!=null&&e.energy<=50&&e.jump(r)}}function y(e,i){let r=e[0],o=e[1],l=i[0],t=i[1],n=l-r,m=t-o;return Math.sqrt(m*m+n*n)}function f(e,i,r){var o=i[0]-e[0],l=i[1]-e[1],t=Math.sqrt(o*o+l*l),n=r/t;let m=e[0]+o*n,a=e[1]+l*n;var u=[m,a];return u}function V(e){let i=_,r=y(e.position,_.position),o=y(e.position,h.position),l=y(e.position,z.position);return o<r&&(i=h),l<y(e.position,i.position)&&(i=z),i}function ke(){y(base.position,star_zxq.position)<y(base.position,star_a1c.position)?(_=star_zxq,z=star_a1c):(_=star_a1c,z=star_zxq)}function ze(){for(spirit of my_spirits)if(spirit.hp>0){let e=parseInt(spirit.mark,10);H[e]=H[e]+1}memory.markcounts=H}function M(e,i){if(i.length==0)return null;var r=spirits[i[0]],o=9999;for(id of i)y(e.position,spirits[id].position)<o&&(r=spirits[id],o=y(e.position,r.position));return r}function W(e,i){if(i.length==0)return null;var r=spirits[i[0]],o=9999;for(id of i)y(e,spirits[id].position)<o&&(r=spirits[id],o=y(e,r.position));return r}function $(e){var i=[];for(id of e)i.push(spirits[id]);return i}function A(e){var i=0;for(spirit of e)i+=spirit.energy;return i}function c(e,i=200){var r=$(e.sight.enemies),o=[];for(enemy of r)y(enemy.position,e.position)<=i&&o.push(enemy);return o}function j(e,i=200){var r=$(e.sight.friends),o=[];for(ally of r)y(ally.position,e.position)<=i&&o.push(ally);return o}function _e(){var e=[];for(spirit of my_spirits)spirit.hp>0&&e.push(spirit);return e}function R(e){var i=c(e);if(i.length!=0&&e.energy!=0){var r=[];for(ally of my_spirits)r.push(memory[ally.id+"attack target"]);var o,l,t,n;for(enemy of i){var m=0;for(target of r)target==enemy.id&&(m+=1);(o==null||m<o)&&(o=m,t=enemy),(l==null||m>l)&&(l=m,n=enemy)}if(!(o*g*.2>t.energy))return memory[e.id+"jumped"]=!1,l*g*.2<=n.energy?(memory[e.id+"attack target"]=n.id,e.energize(n),n):(memory[e.id+"attack target"]=t.id,e.energize(t),t)}}function q(e){var i=j(e);if(i.length!=0&&e.energy!=0){var r=[];for(ally of my_spirits)r.push(memory[ally.id+"heal target"]);var o,l;for(ally of i){var t=0;for(target of r)target==ally.id&&(t+=1);(o==null||t<o)&&!(["Gathering","Depositing","Chaining","Healing"].includes(memory[ally.id])&&I(ally)==null)&&ally.energy<g&&memory[ally.id+"heal target"]!=e.id&&(o=t,l=ally)}if(l==null)return null;if(!(o*g*.1>g-l.energy||y(V(l).position,l.position)<=200&&V(l).energy>=g*.1))return memory[e.id+"heal target"]=l.id,e.energize(l),l}}function w(e){if(!(g<100)){var i=c(e,400),r=[];for(enemy of i){var u=f(enemy.position,e.position,160),o=y(u,e.position),l=j(enemy,210),t=enemy.energy-enemy.size,n=je(enemy);(enemy.energy<=19&&(enemy.energy_capacity>=20||ie(e)=="DefendBase")&&e.energy-10>o/5+t+n+1&&y(enemy.position,e.position)>195&&!ee(enemy)&&j(enemy,250).length==0||enemy.energy<=19&&(enemy.energy_capacity>=20||ie(e)=="DefendBase")&&e.energy-10>o/5+t+n+A(l)*2&&y(enemy.position,e.position)>195&&y(enemy.position,e.position)<360&&!ee(enemy))&&r.push(enemy)}var m=[];for(ally of my_spirits)m.push(memory[ally.id+"jump target"]),m.push(memory[ally.id+"attack target"]);var a;for(enemy of r)if(!m.includes(enemy.id)){a=enemy;break}if(a==null)return null;var u=f(a.position,e.position,150);return e.jump(u),e.move(u),e.energize(a),memory[ally.id+"jump target"]=a.id,memory[e.id+"jumped"]=!0,a}}function C(e){var i=j(e),r=[];for(ally of i)(I(ally)!=null||ally.energy<e.energy&&c(ally,300).length>0&&y(s.position,V(s).position)>200)&&r.push(ally);if(r.length==0)return null;var o,l;for(ally of r)(o==null||o>ally.energy)&&(o=ally.energy,l=ally);return memory[e.id+"heal target"]=l.id,e.energize(l),l}function De(){for(spirit of my_spirits)memory[spirit.id+"attack target"]="",memory[spirit.id+"heal target"]="",memory[spirit.id+"jump target"]=""}function d(e,i){if(e.move(i),outpost.control=="Aecert"||outpost.energy==0)return;let r=400;if(outpost.energy>400&&(r=600),y(e.position,outpost.position)<=r){e.move(f(outpost.position,e.position,r+5));return}let o=[e.position,i],l=0;if(outpost.control!="Aecert"&&outpost.energy!=0)for(;B(outpost.position,o[0],o[1])<=r+5;){let t=J(o[0],o[1],l),n=J(o[0],o[1],-l);if(B(outpost.position,e.position,t)>r){e.move(t);return}if(B(outpost.position,e.position,n)>r){e.move(n);return}l>200&&e.move(f(outpost.position,e.position,r+5)),l+=.1}}function X(e,i){e.move(i);let r=260,o=M(e,e.sight.enemies);if(o==null)return;if(y(e.position,o.position)<=200){e.move(f(o.position,e.position,r));return}let t=[e.position,i],n=0;for(;B(o.position,t[0],t[1])<=r;){let m=J(t[0],t[1],n),a=J(t[0],t[1],-n);if(B(o.position,e.position,m)>r){e.move(m);return}if(B(o.position,e.position,a)>r){e.move(a);return}if(n>360){e.move(f(o.position,e.position,r+5));return}n+=.1}}function J(e,i,r){let o=i[0],l=i[1];o=o-e[0],l=l-e[1];let t=o*Math.cos(r)-l*Math.sin(r),n=l*Math.cos(r)+o*Math.sin(r);return t=t+e[0],n=n+e[1],[t,n]}function L(e){return e*e}function Y(e,i){return L(e[0]-i[0])+L(e[1]-i[1])}function Se(e,i,r){var o=Y(i,r);if(o===0)return Y(e,i);var l=((e[0]-i[0])*(r[0]-i[0])+(e[1]-i[1])*(r[1]-i[1]))/o;return l=Math.max(0,Math.min(1,l)),Y(e,[i[0]+l*(r[0]-i[0]),i[1]+l*(r[1]-i[1])])}function B(e,i,r){return Math.sqrt(Se(e,i,r))}function D(e){var i=[];for(let r=0;r<10;r++)if(S[r]==e)for(spirit of F(String(r)))i.push(spirit);return i}function He(e){var i=[];for(spirit of my_spirits)memory[spirit.id]==e&&i.push(spirit);return i}function I(e){for(enemy of c(e))if(enemy.last_energized==e.id)return enemy;return null}function Ee(e){var i=[];for(ally of j(e))ally.last_energized==e.id&&i.push(ally);return i}function U(e){for(ally of my_spirits)if(memory[ally.id+"heal target"]==e.id)return!0;return!1}function b(e){var i=!0,r=[];for(enemy of c(e,200))enemy.last_energized==e.id&&r.push(enemy);return r.length==0?i=!0:r.length==1?e.energy>r[0].energy?i=!0:i=!1:r.length==2?e.energy>r[0].energy+r[1].energy*2?i=!0:i=!1:i=A(r)*2<e.energy,i}function ee(e){if(outpost.sight.enemies.length==0||outpost.energy==0)return!1;var i=!1,r=2;outpost.energy>=500&&(r=8);var o=y(e.position,outpost.position),l=o/20*2/outpost.sight.enemies.length;return l>e.energy?!0:(console.log(e.id+" will die to outpost"),!1)}function Ce(e){var i=0;for(spirit of e)spirit.energy<spirit.size?i+=spirit.energy*2:i+=spirit.size*2;return i}function je(e){var i=0;return e.energy<e.size?i+=e.energy*2:i+=e.size*2,i}function F(e){var i=[];for(spirit of my_spirits)spirit.mark==e&&spirit.hp>0&&i.push(spirit);return i}function ie(e){for(let i=0;i<10;i++)if(D(S[i]).includes(e))return S[i]}function we(e,i,r,o){graphics.style=r;let l=parseFloat(e[0]),t=parseFloat(e[1]),n=[!1,!1,!1,!1,!1,!1,!1];i==0&&(n=[!0,!0,!0,!1,!0,!0,!0]),i==1&&(n=[!1,!1,!0,!1,!1,!0,!1]),i==2&&(n=[!0,!1,!0,!0,!0,!1,!0]),i==3&&(n=[!0,!1,!0,!0,!1,!0,!0]),i==4&&(n=[!1,!0,!0,!0,!1,!0,!1]),i==5&&(n=[!0,!0,!1,!0,!1,!0,!0]),i==6&&(n=[!0,!0,!1,!0,!0,!0,!0]),i==7&&(n=[!0,!1,!0,!1,!1,!0,!1]),i==8&&(n=[!0,!0,!0,!0,!0,!0,!0]),i==9&&(n=[!0,!0,!0,!0,!1,!0,!0]),n[0]&&graphics.line([l-5*o,t-10*o],[l+5*o,t-10*o]),n[1]&&graphics.line([l-5*o,t-10*o],[l-5*o,t]),n[2]&&graphics.line([l+5*o,t-10*o],[l+5*o,t]),n[3]&&graphics.line([l-5*o,t],[l+5*o,t]),n[4]&&graphics.line([l-5*o,t+10*o],[l-5*o,t]),n[5]&&graphics.line([l+5*o,t+10*o],[l+5*o,t]),n[6]&&graphics.line([l-5*o,t+10*o],[l+5*o,t+10*o])}})();
